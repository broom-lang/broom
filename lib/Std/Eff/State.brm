val State : interface
    extends effect interface
        type t s

        val Get : pi s => {:} -> s
        val Set : pi s => s -> {:}
    end

    val run : pi e s a => ({:} -> ! (e with State : t s) v) -> s -> ({:} -> ! e {state : s, value : v})
    val eval : pi e s a => ({:} -> ! (e with State : t s) v) -> s -> ({:} -> ! e v)
    val run : pi e s a => ({:} -> ! (e with State : t s) v) -> s -> ({:} -> ! e s)
end = module
    extends effect module
        type t s

        val Get : pi s => {:} -> s
        val Set : pi s => s -> {:}
    end
    # = module
    #     val Get : pi s => {:} -> interface type response = s val request : {:} end
    #     val Set : pi s => s -> interface type response = {:} val request : s end
    # end ?

    fun run thunk state ->
        match thunk {}
        |Â value ->
            fn state -> {state, value} end
        | effect ('State (Get {})) k ->
            fn state -> k state state end
        |Â effect ('State (Set state)) k ->
            fn _ -> k {} state end
        end

    fun eval thunk state = (run thunk state).value

    fun exec thunk state = (run thunk state).state
end

